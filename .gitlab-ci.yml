variables:
  NPM_TOKEN: "test"

image: mcr.microsoft.com/playwright:bionic

stages:
  - setup
  - build
  - test

setup:
  stage: setup
  script:
    # Установка nvm
    - curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash
    - export NVM_DIR="$HOME/.nvm"
    - source "$NVM_DIR/nvm.sh"
    # Установка последней версии Node.js
    - nvm install node
    - node --version
    - npm --version

job_build:
  stage: build
  script:
    - echo "Building the project"

job_test:
  stage: test
  script:
    - echo "Running tests"
    - npm i
    - npx playwright install
    - npm run e2e
job_allure:
  stage: test
  script: npm run allure:generate
  needs:
    - job: job-test
